================
Network Creation
================

The network topology can be created in two different ways:

From the UI
-----------

From the :guilabel:`Inventory / Device Management` page and :guilabel:`Inventory / Link Management` page, by entering the value of each property in a form.
Clicking on the ``Create`` button will open a form with the list of all properties of the object.
Fill the form and click on the ``Save`` button.

.. note:: Some properties are mandatory:
 - Name: objects are uniquely defined by their name.
 - Source and destination: a link needs a source and a destination to be created.

.. note:: In order to visualize the network topology on a map,
  devices must have geographical coordinates (longitude and latitude).

Importing an Excel Spreadsheet
------------------------------

From the :guilabel:`Admin / Administration` page by importing an Excel file (.xls, .xlsx), objects can be created all at once by importing an Excel file.

.. image:: /_static/inventory/network_creation/import_export.png
   :alt: Example of excel spreadsheet for import
   :align: center

Devices must be defined in a spreadsheet in a Tab called "device", and links must be defined in a Tab
called "link".
The first line of a spreadsheet contains the properties, the following lines define the objects,
as demonstrated in the example below.

.. image:: /_static/inventory/network_creation/inventory_spreadsheet.png
   :alt: Example of excel spreadsheet for import
   :align: center

.. note:: You can export an Excel spreadsheet containing the network topology by clicking on the ``Export`` button in the ``Topology Export`` column.
.. note:: If an imported object already exists, its properties will be updated.

Querying an external API
------------------------

Another way to create your network is to query an external API: OpenNMS, Netbox, or LibreNMS.
This can be done from the :guilabel:`Admin / Administration` page, column "Topology Import".

OpenNMS
*******

You can configure the following properties for OpenNMS:
 * REST API: URL of the REST API
 * Devices: URL of the devices that you want to import (this could be a subset of all available devices in the API, like ``https://demo.opennms.org/opennms/rest/nodes?foreignSource=OpenNMS_ATL``)
 * Login & Password: credentials of the REST API.

Netbox
******

You can configure the following properties for OpenNMS:
 * Netbox Address: address of the server where Netbox is installed.
 * Netbox Token: token required by Netbox to use the API. This token is generated by Netbox.

LibreNMS
********

You can configure the following properties for LibreNMS:
 * LibreNMS Address: address of the server where LibreNMS is installed.
 * LibreNMS Token: token required by LibreNMS to use the API (generated by LibreNMS).

Custom properties
-----------------

It is possible to add custom properties to a device.
There are four types of properties that you can add: string, integer, float, and boolean.

Custom properties are read from a YAML file when eNMS starts.
The YAML file must have the following format:

::

 property1:
   pretty_name: Property 1
   type: integer
   default: 4
   add_to_dashboard: False
 property2:
   pretty_name: Property 2
   type: string
   default: "10.145.14.1"
   add_to_dashboard: True
   is_address: True

This YAML file will create two properties:

- "property1": an integer property defaulting to 4, displayed "Property 1" in the GUI.
- "property2": a string property defaulting to "a" displayed "Property 2" in the GUI.

If you want the custom property to appear in the dashboard, set ``add_to_dashboard`` to ``True`` in the YaML file.
The ``pretty_name`` is the name of the property in the web UI.

If you want the custom property to appear as a choice in the GoTTY Web SSH window (e.g if the property is a hostname or an IP address, and you want GoTTY to use it for SSH or Telnet), you can set ``is_address`` to True.

.. note:: You can find examples of YAML files with custom propertyes in :guilabel:`eNMS/tests/custom_properties`.

For eNMS to know where the file with custom properties is located on the server, 
you must set the ``custom_properties`` configuration variable to the path of the YAML file.

Search system
-------------

All network devices are displayed in a table where they can be edited and deleted, 
and filtered. There are two filtering systems.

.. image:: /_static/inventory/network_creation/table_filtering.png
   :alt: Filtering System.
   :align: center

Quick search
************

For a quick search, you can use the textbox displayed above some of the columns in the table.
This search is case-insensitive and based on **inclusion**. If you enter a value in several of these fields,
the results is the list of objects that match all fields (boolean AND).
If you enter "a" in the textbox above "Location" in the "Device Management" table, eNMS will return all devices
for which the location contains either "a" or "A".

Advanced search
***************

The first list in the "Advanced Search" panel lets you decide whether you want to display an object if **all** properties
are a match (boolean AND) or if **any** property is a match (boolean OR).

.. image:: /_static/inventory/network_creation/advanced_filtering.png
   :alt: Filtering System.
   :align: center

The advanced search lets you decide, for each property, whether you want to filter based on inclusion, equality
or a regular expression.

.. note:: The search based on regular expression only works if the database you are using supports it. PostgreSQL and MySQL support regular expressions, but SQLite doesn't.

Besides, the advanced search also lets you filter based on **relationships**.

For example, a device has 3 types of relationships:

- services: indicates whether or not the device is a target of a given service (service or workflow)
- pools: indicates whether or not the device is a target of a given pool.
- links: indicates whether the device is the source or the destination of a link.

You can select services, pools and links in the "Advanced Search" panel for a device, and only the device that are a match
for the relationship will be displayed in the results.

You can use the "Clear Search" button above the table to return to the initial state (no filter).